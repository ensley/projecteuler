---
title: 'Problem 2: Even Fibonacci numbers'
author: John Ensley
date: '2018-06-26'
slug: 002
hidedate: yes
weight: -2
draft: no
---

# [Problem](https://projecteuler.net/problem=2)

> Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting with 1 and 2, the first 10 terms will be:
> 
> 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...
> 
> By considering the terms in the Fibonacci sequence whose values do not exceed four million, find the sum of the even-valued terms.

# Explanation

The naive approach works just fine here. Starting with $F(1) = 1$ and $F(2) = 1$, generate each Fibonacci number by the formula $F(k) = F(k-1) + F(k-2)$. If $F(k)$ is even, add it to a running total. When $F(k) > 4000000$, stop and return the total.

A small improvement can be made by realizing that every third Fibonacci number is even, and they satisfy the recurrence relation

$$
F(k) = 4F(k-3) + F(k-6).
$$

This eliminates the need to check whether each $F(k)$ is even, and cuts down on the number of iterations by a factor of 3. However, the algorithm is already so fast that it hardly makes a difference.

# Implementation

The naive approach:

```{r}
problem002.1 <- function(n) {
  sum <- 0
  f_prev <- 1
  f_cur <- 2
  while(f_cur < n) {
    if (f_cur %% 2 == 0) sum <- sum + f_cur
    f_tmp <- f_cur
    f_cur <- f_cur + f_prev
    f_prev <- f_tmp
  }
  sum
}
```

```{r}
problem002.1(4000000)
```

The improved approach:

```{r}
problem002.2 <- function(n) {
  sum <- 0
  f_prev <- 0
  f_cur <- 2
  while(f_cur < n) {
    sum <- sum + f_cur
    f_tmp <- f_cur
    f_cur <- 4*f_cur + f_prev
    f_prev <- f_tmp
  }
  sum
}
```

```{r}
problem002.2(4000000)
```

# Timing

```{r}
(m <- microbenchmark::microbenchmark(p2.1 = problem002.1(4000000), 
                                     p2.2 = problem002.2(4000000),
                                     unit = 'ms'))
```

The solution takes about `r round(microbenchmark:::summary.microbenchmark(m)$median[2], 3)` milliseconds. Taking advantage of the recurrence relation sped up the (already very fast) runtime by about 5x.